<div class="card text-center" [ngClass]="{'bg-contest': coreConfig.layout.skin != 'dark'}">
  <a [routerLink]="routerLink" class="card-header">
    <div class="avatar bg-primary p-50 m-0 mb-1">
      <div class="avatar-content">
        <i data-feather="flag" class="font-medium-5"></i>
      </div>
    </div>
    <br>
    <h4 class="text-white">
      {{ contest.title }}
    </h4>
  </a>

  <a [routerLink]="routerLink" class="card-body mt-1">
    <div *ngIf="contest.status == 0">
      <h4 class="text-center text-white mb-4">
        {{ 'CONTESTS.CONTEST_ENDS' | translate }}
      </h4>
      <div class="ml-1 mr-1">
        <contest-countdown [clockColor]="textColor" [contest]="contest"></contest-countdown>
      </div>
    </div>

    <div *ngIf="contest.status == -1">
      <h4 class="text-center text-white mb-4">
        {{ 'CONTESTS.CONTEST_STARTS' | translate }}
      </h4>
      <div class="ml-1 mr-1">
        <contest-countdown [clockColor]="textColor" [contest]="contest"></contest-countdown>
      </div>
    </div>

    <div *ngIf="contest.status == 1">
      <h4 class="text-white mb-2">
        {{ 'CONTESTS.CONTEST_FINISHED' | translate }}
      </h4>

      <div *ngIf="top3Contestants.length > 0" class="mt-2 row">
        <div class="col contestant mt-1" [@bounce]="animationState[0]" (mouseenter)="animationState[0]=true;">
          <img width="32" height="32" src="assets/images/icons/contest-medal-2.png">
          <br>
          <contestant-view [teamNameColor]="'white'" [textColor]="'white'" [user]="top3Contestants[1].user" [team]="top3Contestants[1].team"></contestant-view>
        </div>

        <div class="col contestant" [@bounce]="animationState[1]" (mouseenter)="animationState[1]=true;">
          <img width="32" height="32" src="assets/images/icons/contest-medal-1.png">
          <br>
          <contestant-view [teamNameColor]="'white'" [textColor]="'white'" [user]="top3Contestants[0].user" [team]="top3Contestants[0].team"></contestant-view>
        </div>

        <div class="col contestant mt-2" [@bounce]="animationState[2]" (mouseenter)="animationState[2]=true;">
          <img width="32" height="32" src="assets/images/icons/contest-medal-3.png">
          <br>
          <contestant-view [teamNameColor]="'white'" [textColor]="'white'" [user]="top3Contestants[2].user" [team]="top3Contestants[2].team"></contestant-view>
        </div>

      </div>
    </div>
  </a>

  <div class="card-footer justify-content-between d-flex">
    <div>
      <span class="badge badge-glow badge-primary">
        <i data-feather="user"></i>
        <span *ngIf="contest.status == -1">{{ contest.registrantsCount }}</span>
        <span *ngIf="contest.status != -1">{{ contest.contestantsCount }}</span>
      </span>
      <span class="badge badge-glow badge-primary">
        <i [data-feather]="'problem' | iconName"></i>
        {{ contest.problemsCount }}
      </span>
      <span class="badge badge-glow badge-{{ contest.getBadgeType() }}">
        {{ contest.type }}
      </span>
    </div>
    
    <div>
      <span *ngIf="contest.status != 1">
        <kepcoin-spend-swal
          *ngIf="contest.status != 0 && contest.isRated && contest.isRegistered && !contest.doubleRatingPurchased"
          [customContent]="true"
          [purchaseUrl]="'contests/' + contest.id + '/purchase-double-rating/'"
          (success)="contest.doubleRatingPurchased=true;"
          [value]="25"
          class="mr-1"
          ngbTooltip="{{ 'DoubleRating' | translate }}"
        >
          <img height="25" src="assets/images/icons/x2-delta.png">
        </kepcoin-spend-swal>
        <img
          ngbTooltip="{{ 'Purchased' | translate }}"
          *ngIf="contest.isRegistered && contest.isRated && contest.doubleRatingPurchased"
          height="25"
          src="assets/images/icons/x2-delta.png"
          class="mr-1"
        >    
        <kepcoin-spend-swal
          *ngIf="contest.status != 0 && contest.isRated && contest.isRegistered && !contest.saveRatingPurchased"
          [customContent]="true"
          [purchaseUrl]="'contests/' + contest.id + '/purchase-save-rating/'"
          [value]="25"
          (success)="contest.saveRatingPurchased=true;"
          class="mr-1"
          ngbTooltip="{{ 'SaveRating' | translate }}"
        >
          <img height="25" src="assets/images/icons/save-rating.png">    
        </kepcoin-spend-swal>
        <img
          ngbTooltip="{{ 'Purchased' | translate }}"
          *ngIf="contest.isRegistered && contest.isRated && contest.saveRatingPurchased"
          height="25"
          src="assets/images/icons/save-rating.png"
          class="mr-1"
        >    
        <button
          ngbTooltip="{{ 'Cancel' | translate }}"
          rippleEffect
          class="btn btn-sm round btn-gradient-success"
          (click)="cancelRegistration()"
          *ngIf="contest.isRegistered"
        >
          <i data-feather="user" [size]="16"></i> {{ 'Registered' | translate }}
          <i data-feather="x" class="text-danger"></i>
        </button>
        <button
          rippleEffect
          class="btn btn-sm round btn-gradient-primary"
          (click)="openRegistrationModal(registration)"
          *ngIf="!contest.isRegistered"
        >
          <i data-feather="user" [size]="16"></i> {{ 'CONTESTS.REGISTER' | translate }}
        </button>
      </span>
    </div>
  </div>
</div>


<ng-template #registration let-modal>
	<div class="modal-header">
		<h4 class="modal-title">{{ contest.title }}</h4>
	</div>
	<div class="modal-body">
    <div class="form-group">
      <ng-select
      >

      </ng-select>

      <div class="form-group">
      </div>
    </div>  
	</div>
  <div class="modal-footer">
    <button rippleEffect class="btn btn-sm round btn-gradient-primary">
      <i data-feather="user" [size]="16"></i> {{ 'CONTESTS.REGISTER' | translate }}
    </button>
  </div>
</ng-template>
