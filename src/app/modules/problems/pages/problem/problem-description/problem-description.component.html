<div class="problem-description">
  <div class="problem-title">
    <h3 class="mb-2">
      {{ problem.id }}. {{ problem.title }}
    </h3>
  </div>
  
  <problem-body [problem]="problem"></problem-body>

  <ngb-accordion [destroyOnHide]="false" [closeOthers]="false">
    <ngb-panel id="panelMargin1" [cardClass]="'collapse-margin'">
      <ng-template ngbPanelTitle>
        <span>{{ 'Tags' | translate }}</span>
      </ng-template>
      <ng-template ngbPanelContent>
        <div *ngIf="currentUser?.isSuperuser || currentUser?.permissions.canChangeProblemTags && problem.hasSolved else elseBlock">
          <button
            *ngFor="let tag of problem.tags"
            (click)="removeTag(tag)"
            class="btn mb-2 mr-50 btn-relief-primary btn-sm">
            {{ tag.name }} <i data-feather="x"></i>
          </button>

          <ng-select
            appendTo="body"  
            [items]="tags"
            bindValue="id"
            bindLabel="name"
            [dropdownPosition]="'bottom'"
            [(ngModel)]="selectedTag">
          </ng-select>

          <button class="mt-2 btn btn-relief-primary btn-sm" (click)="addTag()">{{ 'Add' | translate }}</button>
        </div>

        <ng-template #elseBlock>
          <span class="badge badge-pill badge-primary" *ngFor="let tag of problem.tags">
            {{ tag.name }}
          </span>
        </ng-template>
      </ng-template>
    </ngb-panel>

    <ngb-panel id="panelMargin2" [cardClass]="'collapse-margin'">
      <ng-template ngbPanelTitle>
        <span>{{ 'Topics' | translate }}</span>
      </ng-template>
      <ng-template ngbPanelContent>
        <div *ngIf="currentUser?.isSuperuser else elseBlock">
          <button
            *ngFor="let topic of problem.topics"
            (click)="removeTopic(topic)"
            class="btn mb-2 mr-50 btn-relief-primary btn-sm">
            {{ topic.name }} <i data-feather="x"></i>
          </button>

          <ng-select
            appendTo="body"  
            [items]="topics"
            bindValue="id"
            bindLabel="name"
            [dropdownPosition]="'bottom'"
            [(ngModel)]="selectedTopic">
          </ng-select>

          <button class="mt-2 btn btn-relief-primary btn-sm" (click)="addTopic()">
            {{ 'Add' | translate }}
          </button>
        </div>

        <ng-template #elseBlock>
          <span
            *ngFor="let topic of problem.topics"
            class="badge badge-pill badge-primary">
            {{ topic.name }}
          </span>
        </ng-template>
      </ng-template>
    </ngb-panel>

    <ngb-panel *ngIf="currentUser && problem.hasSolution" id="panelMargin3" [cardClass]="'collapse-margin'">
      <ng-template ngbPanelTitle>
        <span>{{ 'Solution' | translate }}</span>
      </ng-template>
      <ng-template ngbPanelContent>
        <div *ngIf="problem.userInfo.canViewSolution else elseBlock;">
          <button class="btn btn-sm btn-relief-primary" (click)="openSolutionModal(solution)">
            {{ 'View' | translate }}
          </button>
        </div>
        <ng-template #elseBlock>
          <kepcoin-spend-swal
            [value]="problem.solutionKepcoinValue"
            [purchaseUrl]="'problems/' + problem.id + '/purchase-solution/'"
            (success)="problem.canViewSolution=true;">
          </kepcoin-spend-swal>
        </ng-template>
      </ng-template>
    </ngb-panel>
  </ngb-accordion>

</div>

<ng-template #solution let-modal>
	<div class="modal-header" *ngIf="problem.hasSolution">
		<h4 class="modal-title">{{ 'Solution' | translate }}</h4>
	</div>
	<div class="modal-body">
    <ul ngbNav #nav="ngbNav" class="nav-tabs">
      <li [ngbNavItem]="1" *ngIf="problemSolution.codeCpp">
        <a ngbNavLink>C++</a>
        <ng-template ngbNavContent>
          <clipboard-button [text]="problemSolution.codeCpp"></clipboard-button>
          <pre>{{ problemSolution.codeCpp }}</pre>
        </ng-template>
      </li>
      <li [ngbNavItem]="2" *ngIf="problemSolution.codePy">
        <a ngbNavLink>Python</a>
        <ng-template ngbNavContent>
          <clipboard-button [text]="problemSolution.codePy"></clipboard-button>
          <pre>{{ problemSolution.codePy }}</pre>
        </ng-template>
      </li>
    </ul>

    <div [ngbNavOutlet]="nav" class="mt-2"></div>
	</div>
</ng-template>
